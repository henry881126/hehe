(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-515ac0d6"],{"2dff":function(e,t,n){},"47f6":function(e,t,n){"use strict";var r=n("5c4d"),o=n.n(r);o.a},"5c01":function(e,t,n){"use strict";n.d(t,"d",(function(){return o})),n.d(t,"a",(function(){return i})),n.d(t,"f",(function(){return a})),n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return l})),n.d(t,"e",(function(){return c})),n.d(t,"g",(function(){return d}));var r=n("b775");function o(e){return Object(r["a"])({url:"/user/rolelist",method:"get",params:e})}function i(e){return Object(r["a"])({url:"/user/createRole",method:"post",data:e})}function a(e){return Object(r["a"])({url:"/user/updateRole/",method:"post",data:e})}function s(e){return Object(r["a"])({url:"/user/deleteRole",method:"get",params:e})}function l(e){return Object(r["a"])({url:"/user/allClients",method:"get",params:e})}function c(e){return Object(r["a"])({url:"/user/menus",method:"get",params:e})}function d(e){return Object(r["a"])({url:"/user/menus/granted",method:"post",data:e})}},"5c4d":function(e,t,n){},dbd6:function(e,t,n){"use strict";var r=n("2dff"),o=n.n(r);o.a},e364:function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"login-container"},[n("el-form",{ref:"loginForm",staticClass:"login-form",attrs:{model:e.loginForm,rules:e.loginRules,"auto-complete":"on","label-position":"left"}},[n("div",{staticClass:"title-container"},[n("h3",{staticClass:"title"},[e._v("QLOUD-DAP 登录")])]),e._v(" "),n("el-form-item",{attrs:{prop:"clientId"}},[n("span",{staticClass:"svg-container"},[n("svg-icon",{attrs:{"icon-class":"user"}})],1),e._v(" "),n("el-select",{staticClass:"filter-item",attrs:{placeholder:"-请选择-",clearable:""},on:{change:e.clientChange},model:{value:e.loginForm.clientId,callback:function(t){e.$set(e.loginForm,"clientId",t)},expression:"loginForm.clientId"}},e._l(e.clientTypeOptions,(function(e){return n("el-option",{key:e.clientId,attrs:{label:e.clientName,value:e.clientId}})})),1)],1),e._v(" "),n("el-form-item",{attrs:{prop:"username"}},[n("span",{staticClass:"svg-container"},[n("svg-icon",{attrs:{"icon-class":"user"}})],1),e._v(" "),n("el-input",{ref:"username",attrs:{placeholder:"请输入用户名",name:"username",type:"text",tabindex:"1","auto-complete":"on"},model:{value:e.loginForm.username,callback:function(t){e.$set(e.loginForm,"username",t)},expression:"loginForm.username"}})],1),e._v(" "),n("el-form-item",{attrs:{prop:"password"}},[n("span",{staticClass:"svg-container"},[n("svg-icon",{attrs:{"icon-class":"password"}})],1),e._v(" "),n("el-input",{key:e.passwordType,ref:"password",attrs:{type:e.passwordType,placeholder:"请输入密码",name:"password",tabindex:"2","auto-complete":"on"},model:{value:e.loginForm.password,callback:function(t){e.$set(e.loginForm,"password",t)},expression:"loginForm.password"}}),e._v(" "),n("span",{staticClass:"show-pwd",on:{click:e.showPwd}},[n("svg-icon",{attrs:{"icon-class":"password"===e.passwordType?"eye":"eye-open"}})],1)],1),e._v(" "),n("el-form-item",{attrs:{prop:"validCode"}},[n("span",{staticClass:"svg-container"},[n("i",{staticClass:"el-icon-key"})]),e._v(" "),n("el-input",{ref:"validCode",attrs:{type:"text",placeholder:"请输入验证码",name:"validCode",tabindex:"3","auto-complete":"on"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleLogin(t)}},model:{value:e.loginForm.validCode,callback:function(t){e.$set(e.loginForm,"validCode",t)},expression:"loginForm.validCode"}}),e._v(" "),n("span",{staticClass:"show-pwd",on:{click:e.getLonginCodeData}},[n("img",{staticClass:"code-img",attrs:{src:e.code_url}})])],1),e._v(" "),n("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{prop:"deviceId"}},[n("el-input",{ref:"deviceId",attrs:{type:"text"},model:{value:e.loginForm.deviceId,callback:function(t){e.$set(e.loginForm,"deviceId",t)},expression:"loginForm.deviceId"}})],1),e._v(" "),n("el-button",{staticStyle:{width:"100%","margin-bottom":"30px"},attrs:{loading:e.loading,type:"primary"},nativeOn:{click:function(t){return t.preventDefault(),e.handleLogin(t)}}},[e._v("登录")])],1)],1)},o=[],i=(n("b449"),n("51bc")),a=(n("61f7"),n("0d3c")),s=n("5f87"),l=n("5c01"),c=n("83d6"),d=n.n(c),u=n("2ca7"),p={name:"Login",data:function(){var e=function(e,t,n){0==t.length?n(new Error("用户名不能为空")):n()},t=function(e,t,n){0==t.length&&n(new Error("密码不能为空")),t.length<4&&t.length>0?n(new Error("密码不能小于4位")):n()},n=function(e,t,n){0===t.length?n(new Error("验证码不能为空")):t.length<4&&t.length>0?n(new Error("验证码不小于4位")):n()};return{clientInfo:d.a.clientInfo,clientTypeOptions:[],loginForm:{clientId:"",username:"",password:"",deviceId:"",validCode:""},loginRules:{username:[{required:!0,trigger:"blur",validator:e}],password:[{required:!0,trigger:"blur",validator:t}],validCode:[{required:!0,trigger:"blur",validator:n}]},loading:!1,passwordType:"password",code_url:"",deviceId:"",redirect:void 0}},mounted:function(){var e=Object(s["b"])();this.loginForm.deviceId=e,this.initClients()},watch:{$route:{handler:function(e){this.redirect=e.query&&e.query.redirect},immediate:!0}},methods:{getLonginCodeData:function(){var e=this,t=null;this.loginForm.deviceId?(this.loginForm.deviceId,t={uid:this.loginForm.deviceId,t:Date.parse(new Date)}):(Object(s["b"])(),t={uid:this.loginForm.deviceId}),Object(a["g"])(t).then((function(t){console.log("response",t),e.code_url=t.data.url})).catch((function(e){}))},initClients:function(){var e=this;this.getLonginCodeData(),Object(l["c"])().then((function(t){var n=[],r=t.data.datas;r&&(r.map((function(e){n.push(e)})),e.loginForm.clientId=n[0].clientId,e.clientTypeOptions=n,e.clientInfo={clientId:n[0].clientId,clientSecret:n[0].clientId})}))},clientChange:function(e){this.username="",this.password="",this.clientInfo={clientId:this.loginForm.clientId,clientSecret:this.loginForm.clientId}},showPwd:function(){var e=this;"password"===this.passwordType?this.passwordType="":this.passwordType="password",this.$nextTick((function(){e.$refs.password.focus()}))},handleLogin:function(){var e=this;this.$refs.loginForm.validate((function(t){if(!t)return console.log("error submit!!"),!1;e.loading=!0;var n=Object.assign({},e.loginForm);n["clientInfo"]=e.clientInfo,e.$store.dispatch("user/login",n).then(Object(i["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$store.dispatch("permission/generateRoutes");case 2:if(n=t.sent,!(n&&n.length>0)){t.next=8;break}console.log("动态路由：",n),e.$router.push({path:e.redirect||n[0].redirect}),t.next=12;break;case 8:if(!n||0!=n.length){t.next=12;break}return Object(u["Message"])({message:"您没有该系统的登录权限，请联系管理员。",type:"warning",duration:5e3}),e.loading=!1,t.abrupt("return");case 12:e.loading=!1;case 13:case"end":return t.stop()}}),t)})))).catch((function(){e.getLonginCodeData(),e.loading=!1}))}))}}},g=p,m=(n("dbd6"),n("47f6"),n("4023")),f=Object(m["a"])(g,r,o,!1,null,"231dc582",null);t["default"]=f.exports}}]);